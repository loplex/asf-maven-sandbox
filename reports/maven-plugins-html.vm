<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
#set( $jira = $xmlrpc.connect("swizzletester:swizzle","http://jira.codehaus.org/rpc/xmlrpc") )
#set( $projects = $jira.getProjects().matches("name", "Maven 2.*Plugin") )
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Number of votes on opened issues for Maven plugins</title>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />                                                
  </head>
  <body>
	#foreach( $project in $projects )
	#set( $url = "http://jira.codehaus.org/secure/IssueNavigator.jspa?view=rss&&pid=${project.id}&status=1&sorter/field=issuekey&sorter/order=DESC&tempMax=100&reset=true&decorator=none" )
	#set( $jirarss = $rss.fetch( $url ) )
	#set( $project.attributes.totalVotes = $jirarss.issues.sum("votes") )
	## keep the issues in case you want them later
	#set( $project.attributes.issues = $jirarss.issues )
	#end
	<h1>Plugins overview</h1>
	<p>Number of votes on opened issues for Maven plugins sorted by descending votes count</p>
    <table align="center">
      <tr>
		<th>Plugin</th>
		<th>Number of votes</th>
	  </tr>
	#foreach( $project in $projects.descending("@totalVotes") )
	  <tr>
		<td><a href="#$project.name">$project.name</a></td>
		<td>$project.attributes.totalVotes</td>
	  </tr>
	#end
    </table>
    <h1>Plugins details</h1>
	#foreach( $project in $projects.descending("@totalVotes") ) 
    <a name="$project.name"/><h2>$project.name</h2>
    <p>$project.attributes.totalVotes votes</p>
    <table align="center">
      <tr>
		<th>Votes</th>
		<th>Key</th>
		<th>Summary</th>
	  </tr>
	  #foreach( $issue in $project.attributes.issues.descending("votes") )
  	  <tr>
		<td>$issue.votes</td>
		<td><a href="http://jira.codehaus.org/browse/$issue.key">$issue.key</a></td>
		<td>$issue.summary</td>
	  </tr>
	  #end
    </table>
	#end
  </body>
</html>