<?xml version="1.0" encoding="UTF-8"?>

<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->

<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>

  <parent>
    <!-- ideally Doxia parent pom -->
    <groupId>org.apache.maven</groupId>
    <artifactId>maven-parent</artifactId>
    <version>21</version>
    <relativePath/>
  </parent>

  <groupId>org.apache.maven.doxia.ide</groupId>
  <artifactId>eclipse-parent</artifactId>
  <version>1.0-SNAPSHOT</version>
  <packaging>pom</packaging>

  <name>Doxia Tools :: Eclipse IDE - Parent POM</name>
  <description>Parent POM for the defacto IDE for Doxia development</description>

  <prerequisites>
    <maven>3.0.3</maven>
  </prerequisites>

  <scm>
    <connection>scm:svn:https://svn.apache.org/repos/asf/maven/sandbox/trunk/doxia/doxia-ide/eclipse</connection>
    <developerConnection>scm:svn:https://svn.apache.org/repos/asf/maven/sandbox/trunk/doxia/doxia-ide/eclipse</developerConnection>
    <url>https://svn.apache.org/repos/asf/maven/sandbox/trunk/doxia/doxia-ide/eclipse</url>
  </scm>

  <properties>
    <libdir>${project.build.outputDirectory}/lib</libdir>
    <manifestdir>${project.build.outputDirectory}/META-INF</manifestdir>
    <maven-bundle-plugin-version>2.3.5</maven-bundle-plugin-version>
  </properties>

  <modules>
    <module>doxia-osgi</module>
    <module>eclipse-plugins</module>
  </modules>

  <dependencyManagement>
    <dependencies>
      <!-- Eclipse SDK: see MNG-3518 -->
      <dependency>
        <groupId>org.eclipse.core</groupId>
        <artifactId>resources</artifactId>
        <version>[3.2.0,4.0.0)</version>
      </dependency>
      <dependency>
        <groupId>org.eclipse.core</groupId>
        <artifactId>runtime</artifactId>
        <version>[3.2.0,4.0.0)</version>
      </dependency>
      <dependency>
        <groupId>org.eclipse</groupId>
        <artifactId>ui</artifactId>
        <version>[3.2.0,4.0.0)</version>
      </dependency>
      <dependency>
        <groupId>org.eclipse.ui</groupId>
        <artifactId>editors</artifactId>
        <version>[3.2.0,4.0.0)</version>
      </dependency>
      <dependency>
        <groupId>org.eclipse.ui</groupId>
        <artifactId>ide</artifactId>
        <version>[3.2.0,4.0.0)</version>
      </dependency>
      <dependency>
        <groupId>org.eclipse.jface</groupId>
        <artifactId>text</artifactId>
        <version>[3.2.0,4.0.0)</version>
      </dependency>

      <!-- Eclipse WTP: see MNG-3518 -->
      <dependency>
        <groupId>org.eclipse.wst.sse</groupId>
        <artifactId>core</artifactId>
        <version>[1.1.0,1.2.0)</version>
      </dependency>
      <dependency>
        <groupId>org.eclipse.wst.sse</groupId>
        <artifactId>ui</artifactId>
        <version>[1.0.0,1.2.0)</version>
      </dependency>
      <dependency>
        <groupId>org.eclipse.wst.xml</groupId>
        <artifactId>core</artifactId>
        <version>[1.0.0,1.2.0)</version>
        <exclusions>
          <exclusion>
            <groupId>org.apache</groupId>
            <artifactId>xerces</artifactId>
          </exclusion>
        </exclusions>
      </dependency>
      <dependency>
        <groupId>org.eclipse.wst.xml</groupId>
        <artifactId>ui</artifactId>
        <version>[1.0.0,1.2.0)</version>
      </dependency>
      <dependency>
        <groupId>org.eclipse.wst.common</groupId>
        <artifactId>ui</artifactId>
        <version>[1.1.0,1.2.0)</version>
      </dependency>

    </dependencies>
  </dependencyManagement>

  <build>
    <pluginManagement>
      <plugins>
        <plugin>
          <groupId>org.apache.maven.plugins</groupId>
          <artifactId>maven-release-plugin</artifactId>
          <configuration>
            <tagBase>https://svn.apache.org/repos/asf/maven/sandbox/tags</tagBase>
            <branchBase>https://svn.apache.org/repos/asf/maven/sandbox/branches</branchBase>
            <autoVersionSubmodules>true</autoVersionSubmodules>
          </configuration>
        </plugin>
        <plugin>
          <groupId>org.apache.maven.plugins</groupId>
          <artifactId>maven-compiler-plugin</artifactId>
          <configuration>
            <source>1.6</source>
            <target>1.6</target>
          </configuration>
        </plugin>
        <plugin>
          <groupId>org.apache.maven.plugins</groupId>
          <artifactId>maven-dependency-plugin</artifactId>
          <version>2.3</version>
        </plugin>
        <plugin>
          <groupId>org.apache.maven.plugins</groupId>
          <artifactId>maven-eclipse-plugin</artifactId>
          <version>2.6</version>
          <configuration>
            <projectNameTemplate>${project.groupId}-${project.artifactId}</projectNameTemplate>
            <downloadSources>true</downloadSources>
            <downloadJavadocs>false</downloadJavadocs>
            <additionalBuildcommands>
              <buildcommand>org.eclipse.jdt.core.javabuilder</buildcommand>
              <buildcommand>org.eclipse.pde.ManifestBuilder</buildcommand>
              <buildcommand>org.eclipse.pde.SchemaBuilder</buildcommand>
            </additionalBuildcommands>
            <additionalProjectnatures>
              <projectnature>org.eclipse.pde.PluginNature</projectnature>
              <projectnature>org.eclipse.jdt.core.javanature</projectnature>
            </additionalProjectnatures>
            <classpathContainers>
              <classpathContainer>org.eclipse.jdt.launching.JRE_CONTAINER</classpathContainer>
              <classpathContainer>org.eclipse.pde.core.requiredPlugins</classpathContainer>
            </classpathContainers>
          </configuration>
        </plugin>
        <plugin>
          <groupId>org.apache.felix</groupId>
          <artifactId>maven-bundle-plugin</artifactId>
          <version>${maven-bundle-plugin-version}</version>
        </plugin>
      </plugins>
    </pluginManagement>

    <plugins>
      <!-- See MNG-3517 -->
      <plugin>
        <groupId>org.codehaus.plexus</groupId>
        <artifactId>plexus-maven-plugin</artifactId>
        <version>1.3.8</version>
      </plugin>
    </plugins>
  </build>

  <!-- Eclipse dependencyManagement OS specific -->
  <profiles>
    <profile>
      <id>linux-x86</id>
      <activation>
        <os>
          <arch>i386</arch>
          <family>unix</family>
          <name>linux</name>
        </os>
      </activation>
      <dependencyManagement>
        <dependencies>
          <dependency>
            <groupId>org.eclipse.swt.gtk.linux</groupId>
            <artifactId>x86</artifactId>
            <version>[3.2.0,4.0.0)</version>
          </dependency>
        </dependencies>
      </dependencyManagement>
    </profile>
    <profile>
      <id>linux-x86_64</id>
      <activation>
        <os>
          <arch>amd64</arch>
          <family>unix</family>
          <name>linux</name>
        </os>
      </activation>
      <dependencyManagement>
        <dependencies>
          <dependency>
            <groupId>org.eclipse.swt.gtk.linux</groupId>
            <artifactId>x86_64</artifactId>
            <version>[3.2.0,4.0.0)</version>
          </dependency>
        </dependencies>
      </dependencyManagement>
    </profile>
    <profile>
      <id>solaris-sparc</id>
      <activation>
        <os>
          <arch>sparc</arch>
          <family>unix</family>
          <name>SunOS</name>
        </os>
      </activation>
      <dependencyManagement>
        <dependencies>
          <dependency>
            <groupId>org.eclipse.swt.gtk.solaris</groupId>
            <artifactId>sparc</artifactId>
            <version>[3.2.0,4.0.0)</version>
          </dependency>
        </dependencies>
      </dependencyManagement>
    </profile>
    <profile>
      <id>macosx</id>
      <activation>
        <os>
          <family>unix</family>
          <name>mac os x</name>
        </os>
      </activation>
      <dependencyManagement>
        <dependencies>
          <dependency>
            <groupId>org.eclipse.swt.carbon</groupId>
            <artifactId>macosx</artifactId>
            <version>[3.2.0,4.0.0)</version>
          </dependency>
        </dependencies>
      </dependencyManagement>
    </profile>
    <profile>
      <id>win32</id>
      <activation>
        <os>
          <arch>x86</arch>
          <family>windows</family>
        </os>
      </activation>
      <dependencyManagement>
        <dependencies>
          <dependency>
            <groupId>org.eclipse.swt.win32.win32</groupId>
            <artifactId>x86</artifactId>
            <version>[3.2.0,4.0.0)</version>
          </dependency>
        </dependencies>
      </dependencyManagement>
    </profile>
    <profile>
      <id>win64</id>
      <activation>
        <os>
          <arch>amd64</arch>
          <family>windows</family>
        </os>
      </activation>
      <dependencyManagement>
        <dependencies>
          <dependency>
            <groupId>org.eclipse.swt.win32.win32</groupId>
            <artifactId>x86_64</artifactId>
            <version>[3.2.0,4.0.0)</version>
          </dependency>
        </dependencies>
      </dependencyManagement>
    </profile>
    <profile>
      <id>to-eclipse</id>
      <build>
        <defaultGoal>validate</defaultGoal>
        <plugins>
          <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-antrun-plugin</artifactId>
            <executions>
              <execution>
                <phase>validate</phase>
                <configuration>
                  <target>

                    <taskdef resource="net/sf/antcontrib/antcontrib.properties" />

                    <!-- Same that download-eclipse profile -->
                    <available file="${install.dir}/plugins" property="eclipse.present" />

                    <if>
                      <equals arg1="${eclipse.present}" arg2="true" />
                      <then>
                        <echo level="info">Eclipse home: ${install.dir}</echo>
                      </then>
                      <else>
                        <echo level="info">No custom Eclipse home defined, using default in Tmp dir</echo>
                        <property name="install.dir" location="${java.io.tmpdir}/eclipse" relative="true" />
                        <available file="${install.dir}/plugins" property="eclipse.present" />
                        <fail unless="eclipse.present">
The ${install.dir} doesn't exist. Please run the -Pdownload-eclipse first</fail>
                      </else>
                    </if>

                    <available file="${basedir}/plugins" type="dir" property="plugins.present" />

                    <if>
                      <equals arg1="${plugins.present}" arg2="true" />
                      <then>
                        <echo message="Copying Doxia IDE to ${install.dir}/plugins..." />
                        <copy todir="${install.dir}/plugins" verbose="true" overwrite="true">
                          <fileset dir="${basedir}/plugins/org.apache.maven.doxia.ide.eclipse.apt.ui/target">
                            <include name="org.apache.maven.doxia.ide.eclipse.*.jar" />
                          </fileset>
                          <fileset dir="${basedir}/plugins/org.apache.maven.doxia.ide.eclipse.common.ui/target">
                            <include name="org.apache.maven.doxia.ide.eclipse.*.jar" />
                          </fileset>
                          <fileset dir="${basedir}/plugins/org.apache.maven.doxia.ide.eclipse.confluence.ui/target">
                            <include name="org.apache.maven.doxia.ide.eclipse.*.jar" />
                          </fileset>
                          <fileset dir="${basedir}/plugins/org.apache.maven.doxia.ide.eclipse.docbook.ui/target">
                            <include name="org.apache.maven.doxia.ide.eclipse.*.jar" />
                          </fileset>
                          <fileset dir="${basedir}/plugins/org.apache.maven.doxia.ide.eclipse.fml.ui/target">
                            <include name="org.apache.maven.doxia.ide.eclipse.*.jar" />
                          </fileset>
                          <fileset dir="${basedir}/plugins/org.apache.maven.doxia.ide.eclipse.help/target">
                            <include name="org.apache.maven.doxia.ide.eclipse.*.jar" />
                          </fileset>
                          <fileset dir="${basedir}/plugins/org.apache.maven.doxia.ide.eclipse.twiki.ui/target">
                            <include name="org.apache.maven.doxia.ide.eclipse.*.jar" />
                          </fileset>
                          <fileset dir="${basedir}/plugins/org.apache.maven.doxia.ide.eclipse.xdoc.ui/target">
                            <include name="org.apache.maven.doxia.ide.eclipse.*.jar" />
                          </fileset>
                          <fileset dir="${basedir}/plugins/org.apache.maven.doxia.ide.eclipse.xhtml.ui/target">
                            <include name="org.apache.maven.doxia.ide.eclipse.*.jar" />
                          </fileset>
                        </copy>
                     </then>
                    </if>

                  </target>
                </configuration>
                <goals>
                  <goal>run</goal>
                </goals>
              </execution>
            </executions>
            <dependencies>
              <dependency>
                <groupId>org.apache.ant</groupId>
                <artifactId>ant-nodeps</artifactId>
                <version>1.8.1</version>
              </dependency>
              <dependency>
                <groupId>ant-contrib</groupId>
                <artifactId>ant-contrib</artifactId>
                <version>1.0b2</version>
                <exclusions>
                  <exclusion>
                  <groupId>ant</groupId>
                  <artifactId>ant</artifactId>
                  </exclusion>
                </exclusions>
              </dependency>
            </dependencies>
          </plugin>
        </plugins>
      </build>
    </profile>
  </profiles>

</project>
